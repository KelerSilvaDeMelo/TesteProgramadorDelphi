unit UnitDesafioDelphi5;

interface

const
  RequisitoDesafio5 =
    'DESAFIO 5'#10#13#10#13 +
    '1. Receba uma expressão matemática como string (ex.: "10 + (2 * 3)").'#10#13 +
    '2. Valide se os parênteses estão corretamente balanceados. '#10#13 +
    '3. Avalie e retorne o resultado da expressão. ';

procedure DesafioDelphi5;

implementation

uses
  System.Classes, Vcl.Dialogs, System.SysUtils, System.Math, System.RTTI,
  NewMathParser.Oper, NewMathParser;

function EstaBalanceado(const Expressao: String): Boolean;
var
  i, Contador: Integer;
begin
  Contador := 0;
  for i := 1 to Length(Expressao) do
  begin
    if Expressao[i] = '(' then
      Inc(Contador)
    else if Expressao[i] = ')' then
    begin
      Dec(Contador);
      if Contador < 0 then // Parêntese de fechamento sem correspondente de abertura
        Exit(False);
    end;
  end;
  Result := Contador = 0; // Verifica se todos os parênteses foram fechados
end;

function ProcessaDesafio5(Expressao: String): String;
var
  ExpressaoLimpa, Resultado: String;
  Calculo: TMathParser;
begin
  Result := '';
  ExpressaoLimpa := StringReplace(Expressao, ' ', '', [rfReplaceAll]);

  if not EstaBalanceado(ExpressaoLimpa) then
  begin
    Result := 'Expressão desbalanceada: verifique os parênteses.';
    Exit;
  end;

  Calculo := TMathParser.Create;
  try
    try
      Calculo.Expression := ExpressaoLimpa;
      if Calculo.Error.IsNoError then
        Resultado := Calculo.ParserResult.ToString
      else
        Resultado := Calculo.Error.ToString;
    except
      on E: Exception do
        Resultado := 'Erro ao avaliar a expressão.';
    end;
  finally
    Calculo.Free;
  end;

  Result := 'RESULTADO DO DESAFIO 5' + #13#10#13#10
          + 'A avaliação da expressão retornou o seguinte resultado:' + #13#10
          + Resultado;
end;

procedure DesafioDelphi5;
var
  Expressao, Resultado: String;
begin
  Expressao := '10 + (2 * 3)';

  ShowMessage(RequisitoDesafio5 + #13#10#13#10 + Expressao);

  Resultado := ProcessaDesafio5(Expressao);
  ShowMessage(Resultado);
end;

end.

